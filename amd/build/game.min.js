define("mod_kahoodle/game",["exports","core/pubsub","tool_realtime/events","core/notification","tool_realtime/api","core/templates"],(function(_exports,PubSub,RealTimeEvents,Notification,RealTimeApi,_templates){var obj;function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}
/**
   * TODO describe module game
   *
   * @module     mod_kahoodle/game
   * @copyright  Marina Glancy
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.doTransition=_exports.doAnswer=void 0,PubSub=_interopRequireWildcard(PubSub),RealTimeEvents=_interopRequireWildcard(RealTimeEvents),Notification=_interopRequireWildcard(Notification),RealTimeApi=_interopRequireWildcard(RealTimeApi),_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};const SELECTORS_MAINDIV="#mod_kahoodle_game[data-cmid][data-contextid]",SELECTORS_TRANSITIONBUTTON='[data-action="transition"]';var initialised=!1;_exports.init=()=>{initialised||(initialised=!0,PubSub.subscribe(RealTimeEvents.CONNECTION_LOST,(e=>{window.console.log("Error",e),Notification.exception({name:"Error",message:"Something went wrong, please refresh the page"})})),PubSub.subscribe(RealTimeEvents.EVENT,(data=>{window.console.log("received event "+JSON.stringify(data));const{context:context,component:component,payload:payload}=data;window.console.log("-details-: "+JSON.stringify({contextid:context.id,component:component,payload:payload}));const node=document.querySelector(SELECTORS_MAINDIV);if(!payload||"mod_kahoodle"!=component||context.id!=node.dataset.contextid)return void window.console.log("Ignoring event for different context or component");const updates=data.payload;window.console.log("updates = "+JSON.stringify(updates)),updates.template?void 0===updates.data?window.console.error("Unexpected result - data is missing"):_templates.default.render(updates.template,updates.data).then((function(html,js){return _templates.default.replaceNodeContents(node,html,js),null})).catch((function(error){window.console.error("Error rendering template:",error)})):window.console.error("Unexpected result - template is missing")})),document.addEventListener("click",(e=>{e.target.closest(SELECTORS_MAINDIV+" "+SELECTORS_TRANSITIONBUTTON)&&doTransition()})))};const doTransition=()=>{const node=document.querySelector(SELECTORS_MAINDIV);RealTimeApi.sendToServer({contextid:node.dataset.contextid,component:"mod_kahoodle",area:"game",itemid:0},{action:"transition"})};_exports.doTransition=doTransition;_exports.doAnswer=(questionid,answer)=>{var _node$dataset$playeri;const node=document.querySelector(SELECTORS_MAINDIV);RealTimeApi.sendToServer({contextid:node.dataset.contextid,component:"mod_kahoodle",area:"game",itemid:parseInt(null!==(_node$dataset$playeri=node.dataset.playerid)&&void 0!==_node$dataset$playeri?_node$dataset$playeri:0)},{action:"answer",questionid:questionid,answer:answer})}}));

//# sourceMappingURL=game.min.js.map